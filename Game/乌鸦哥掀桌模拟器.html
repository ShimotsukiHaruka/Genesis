<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乌鸦哥掀桌模拟器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ff2a2a, 0 0 20px #ff2a2a;
            background: linear-gradient(45deg, #ff8a00, #ff2a2a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 20px;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 500px;
            border: 3px solid #ff2a2a;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 42, 42, 0.5);
            background: #0f3460;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .power-bar-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 30px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #fff;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .power-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);
            transition: width 0.1s;
        }
        
        .perfect-zone {
            position: absolute;
            height: 100%;
            width: 40px;
            background: rgba(255, 255, 255, 0.3);
            left: 40%;
            border-left: 2px dashed #fff;
            border-right: 2px dashed #fff;
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 10px;
        }
        
        .level-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 10px;
        }
        
        .instructions {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 0 0 10px #ff2a2a;
            opacity: 0;
            transition: opacity 0.5s;
            text-align: center;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(45deg, #ff2a2a, #ff8a00);
            border: none;
            color: white;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 42, 42, 0.4);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 42, 42, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .game-info {
            max-width: 800px;
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            line-height: 1.6;
        }
        
        .game-info h2 {
            color: #ff8a00;
            margin-bottom: 10px;
            border-bottom: 2px solid #ff8a00;
            padding-bottom: 5px;
        }
        
        .game-info ul {
            margin-left: 20px;
        }
        
        .game-info li {
            margin-bottom: 8px;
        }
        
        .audio-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            max-width: 300px;
        }
        
        .audio-btn {
            background: linear-gradient(45deg, #2a7aff, #00c3ff);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: 100%;
        }
        
        .audio-status {
            font-size: 1rem;
            color: #00ff00;
            text-align: center;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        
        .volume-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #333;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #2a7aff;
            cursor: pointer;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            .game-container {
                height: 400px;
            }
            
            .instructions {
                font-size: 1rem;
                bottom: 60px;
            }
            
            .power-bar-container {
                width: 250px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>乌鸦哥掀桌模拟器</h1>
        <p class="subtitle">"难办？我瞧就别办啦！" - 体验乌鸦哥的经典瞬间</p>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="ui-overlay">
            <div class="score-display">分数: <span id="score">0</span></div>
            <div class="level-display">关卡: <span id="level">1</span></div>
            
            <div class="power-bar-container">
                <div class="perfect-zone"></div>
                <div class="power-bar" id="powerBar"></div>
            </div>
            
            <div class="instructions">
                按住鼠标/触摸屏蓄力，在绿色区域释放实现完美掀桌！
            </div>
            
            <div class="message" id="message"></div>
        </div>
    </div>
    
    <div class="controls">
        <button id="startBtn">开始游戏</button>
        <button id="resetBtn">重新开始</button>
        <button id="helpBtn">游戏说明</button>
        
        <div class="audio-controls">
            <button id="bgMusicBtn" class="audio-btn">播放背景音乐</button>
            <button id="flipSoundBtn" class="audio-btn">测试掀桌音效</button>
            
            <div class="volume-control">
                <span>音量:</span>
                <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider">
            </div>
            
            <div id="audioStatus" class="audio-status">音频已准备</div>
        </div>
    </div>
    
    <div class="game-info">
        <h2>游戏规则</h2>
        <ul>
            <li>按住鼠标/触摸屏开始蓄力，蓄力条会左右摆动</li>
            <li>在绿色区域（完美区域）释放鼠标/手指，实现完美掀桌</li>
            <li>完美掀桌可以获得3倍分数，并吓跑对手</li>
            <li>每吓跑一个对手进入下一关，难度会增加</li>
            <li>连续完美掀桌可以获得连击加分</li>
            <li>掀桌时会播放经典音效！</li>
        </ul>
    </div>

    <!-- 音频元素 -->
    <audio id="flipSound" preload="auto" loop>
        <!-- 请将下面的src替换为您的掀桌音频文件路径 -->
        <source src="flip-table-sound.mp3" type="audio/mpeg">
        您的浏览器不支持音频元素。
    </audio>
    
    <audio id="bgMusic" preload="auto" loop>
        <!-- 请将下面的src替换为您的背景音乐文件路径 -->
        <source src="background-music.mp3" type="audio/mpeg">
        您的浏览器不支持音频元素。
    </audio>

    <script>
        // 游戏主逻辑
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            const powerBar = document.getElementById('powerBar');
            const messageElement = document.getElementById('message');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const helpBtn = document.getElementById('helpBtn');
            const bgMusicBtn = document.getElementById('bgMusicBtn');
            const flipSoundBtn = document.getElementById('flipSoundBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const audioStatus = document.getElementById('audioStatus');
            
            // 音频元素
            const flipSound = document.getElementById('flipSound');
            const bgMusic = document.getElementById('bgMusic');
            
            // 音频状态
            let audioLoaded = false;
            let bgMusicPlaying = false;
            let currentVolume = 0.5;
            
            // 设置Canvas尺寸
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // 游戏状态
            let gameState = {
                score: 0,
                level: 1,
                isPlaying: false,
                isCharging: false,
                power: 0,
                powerDirection: 1,
                tableAngle: 0,
                tableFlipped: false,
                opponentState: 'calm', // calm, scared, running
                items: [],
                perfectFlip: false,
                combo: 0,
                maxCombo: 0
            };
            
            // 初始化物品
            function initItems() {
                gameState.items = [];
                // 添加桌子上的物品
                for (let i = 0; i < 8; i++) {
                    gameState.items.push({
                        x: Math.random() * 300 + 250,
                        y: 320 + Math.random() * 20,
                        type: Math.floor(Math.random() * 3), // 0: 酒瓶, 1: 茶杯, 2: 碗
                        vx: 0,
                        vy: 0,
                        rotation: 0,
                        rotationSpeed: 0
                    });
                }
            }
            
            // 设置音量
            function setVolume(volume) {
                currentVolume = volume / 100;
                flipSound.volume = currentVolume;
                bgMusic.volume = currentVolume;
            }
            
            // 播放掀桌音效
            function playFlipSound() {
                if (!audioLoaded) {
                    showMessage('音频未加载完成', '#ff0000');
                    return;
                }
                
                try {
                    flipSound.currentTime = 0; // 重置音频到开始
                    flipSound.play().then(() => {
                        console.log("掀桌音效播放成功");
                    }).catch(e => {
                        console.log("音频播放失败:", e);
                        showMessage('音频播放失败', '#ff0000');
                    });
                } catch (e) {
                    console.log("音频播放异常:", e);
                }
            }
            
            // 播放背景音乐
            function playBgMusic() {
                if (!audioLoaded) {
                    showMessage('音频未加载完成', '#ff0000');
                    return;
                }
                
                try {
                    bgMusic.currentTime = 0;
                    bgMusic.play().then(() => {
                        bgMusicPlaying = true;
                        bgMusicBtn.textContent = '暂停背景音乐';
                        console.log("背景音乐播放成功");
                    }).catch(e => {
                        console.log("背景音乐播放失败:", e);
                        showMessage('背景音乐播放失败', '#ff0000');
                    });
                } catch (e) {
                    console.log("背景音乐播放异常:", e);
                }
            }
            
            // 暂停背景音乐
            function pauseBgMusic() {
                bgMusic.pause();
                bgMusicPlaying = false;
                bgMusicBtn.textContent = '播放背景音乐';
            }
            
            // 切换背景音乐
            function toggleBgMusic() {
                if (bgMusicPlaying) {
                    pauseBgMusic();
                } else {
                    playBgMusic();
                }
            }
            
            // 测试音频
            function testFlipSound() {
                if (!audioLoaded) {
                    showMessage('音频未加载完成', '#ff0000');
                    return;
                }
                
                playFlipSound();
                showMessage('测试音效播放中...', '#00ff00');
            }
            
            // 显示消息
            function showMessage(text, color = '#ff2a2a') {
                messageElement.textContent = text;
                messageElement.style.color = color;
                messageElement.style.opacity = 1;
                
                setTimeout(() => {
                    messageElement.style.opacity = 0;
                }, 1500);
            }
            
            // 开始游戏
            function startGame() {
                gameState.isPlaying = true;
                gameState.score = 0;
                gameState.level = 1;
                gameState.combo = 0;
                gameState.maxCombo = 0;
                gameState.tableFlipped = false;
                gameState.opponentState = 'calm';
                gameState.tableAngle = 0;
                
                scoreElement.textContent = gameState.score;
                levelElement.textContent = gameState.level;
                
                initItems();
                showMessage('游戏开始！', '#00ff00');
                
                // 自动播放背景音乐
                if (!bgMusicPlaying) {
                    playBgMusic();
                }
                
                // 游戏主循环
                gameLoop();
            }
            
            // 重置游戏
            function resetGame() {
                gameState.isPlaying = false;
                startGame();
            }
            
            // 掀桌子
            function flipTable() {
                if (!gameState.isPlaying || gameState.tableFlipped) return;
                
                gameState.tableFlipped = true;
                gameState.isCharging = false;
                
                // 播放掀桌音效
                playFlipSound();
                
                // 判断是否完美掀桌
                const isPerfect = gameState.power > 0.4 && gameState.power < 0.6;
                
                if (isPerfect) {
                    gameState.perfectFlip = true;
                    gameState.combo++;
                    if (gameState.combo > gameState.maxCombo) {
                        gameState.maxCombo = gameState.combo;
                    }
                    
                    const points = 100 * gameState.level * gameState.combo;
                    gameState.score += points;
                    scoreElement.textContent = gameState.score;
                    
                    showMessage(`完美掀桌！+${points}分 连击x${gameState.combo}`, '#00ff00');
                    
                    // 吓跑对手
                    gameState.opponentState = 'scared';
                    setTimeout(() => {
                        gameState.opponentState = 'running';
                    }, 500);
                    
                    // 下一关
                    setTimeout(() => {
                        nextLevel();
                    }, 2000);
                } else {
                    gameState.perfectFlip = false;
                    gameState.combo = 0;
                    
                    const points = Math.floor(30 * gameState.power * gameState.level);
                    gameState.score += points;
                    scoreElement.textContent = gameState.score;
                    
                    if (gameState.power < 0.2) {
                        showMessage('力度太小！', '#ff0000');
                    } else if (gameState.power > 0.8) {
                        showMessage('力度太大！', '#ff0000');
                    } else {
                        showMessage(`掀桌成功！+${points}分`, '#ffff00');
                    }
                    
                    // 重置桌子
                    setTimeout(() => {
                        resetTable();
                    }, 1500);
                }
                
                // 应用物理效果到物品
                const flipPower = gameState.power * 2;
                gameState.items.forEach(item => {
                    item.vx = (Math.random() - 0.5) * 20 * flipPower;
                    item.vy = -Math.random() * 15 * flipPower;
                    item.rotationSpeed = (Math.random() - 0.5) * 0.2;
                });
            }
            
            // 重置桌子
            function resetTable() {
                gameState.tableFlipped = false;
                gameState.tableAngle = 0;
                gameState.opponentState = 'calm';
                initItems();
            }
            
            // 下一关
            function nextLevel() {
                gameState.level++;
                levelElement.textContent = gameState.level;
                resetTable();
                showMessage(`第 ${gameState.level} 关`, '#ff8a00');
            }
            
            // 绘制游戏
            function draw() {
                // 清空画布
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 绘制背景
                drawBackground();
                
                // 绘制对手
                drawOpponent();
                
                // 绘制桌子
                drawTable();
                
                // 绘制物品
                drawItems();
                
                // 绘制乌鸦哥
                drawUglyMan();
            }
            
            // 绘制背景
            function drawBackground() {
                // 餐厅背景
                ctx.fillStyle = '#3d2b1f';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 地板
                ctx.fillStyle = '#5d4037';
                ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
                
                // 墙壁
                ctx.fillStyle = '#8d6e63';
                ctx.fillRect(0, 0, canvas.width, canvas.height - 100);
                
                // 装饰
                ctx.fillStyle = '#6d4c41';
                for (let i = 0; i < canvas.width; i += 40) {
                    ctx.fillRect(i, canvas.height - 100, 20, 10);
                }
                
                // 灯光
                const gradient = ctx.createRadialGradient(
                    canvas.width/2, 100, 10,
                    canvas.width/2, 100, 200
                );
                gradient.addColorStop(0, 'rgba(255, 215, 0, 0.3)');
                gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // 绘制乌鸦哥
            function drawUglyMan() {
                const x = canvas.width / 2 - 200;
                const y = canvas.height - 180;
                
                // 身体
                ctx.fillStyle = '#333';
                ctx.fillRect(x, y, 60, 120);
                
                // 头
                ctx.fillStyle = '#ffdbac';
                ctx.beginPath();
                ctx.arc(x + 30, y - 30, 30, 0, Math.PI * 2);
                ctx.fill();
                
                // 墨镜
                ctx.fillStyle = '#000';
                ctx.fillRect(x + 10, y - 40, 40, 15);
                
                // 手（掀桌动作）
                if (gameState.isCharging) {
                    ctx.fillStyle = '#ffdbac';
                    ctx.fillRect(x + 60, y + 20, 30, 10);
                }
                
                // 文字标识
                ctx.fillStyle = '#fff';
                ctx.font = '16px Arial';
                ctx.fillText('乌鸦哥', x + 10, y - 60);
            }
            
            // 绘制对手
            function drawOpponent() {
                let x = canvas.width / 2 + 100;
                let y = canvas.height - 180;
                
                // 根据状态调整位置
                if (gameState.opponentState === 'scared') {
                    y -= 20;
                } else if (gameState.opponentState === 'running') {
                    x += 200;
                }
                
                // 身体
                ctx.fillStyle = gameState.opponentState === 'calm' ? '#555' : '#a00';
                ctx.fillRect(x, y, 60, 120);
                
                // 头
                ctx.fillStyle = '#ffdbac';
                ctx.beginPath();
                ctx.arc(x + 30, y - 30, 30, 0, Math.PI * 2);
                ctx.fill();
                
                // 表情
                ctx.fillStyle = '#000';
                if (gameState.opponentState === 'calm') {
                    // 平静表情
                    ctx.beginPath();
                    ctx.arc(x + 20, y - 40, 5, 0, Math.PI * 2);
                    ctx.arc(x + 40, y - 40, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(x + 30, y - 25, 10, 0, Math.PI);
                    ctx.stroke();
                } else {
                    // 惊吓表情
                    ctx.beginPath();
                    ctx.arc(x + 20, y - 40, 7, 0, Math.PI * 2);
                    ctx.arc(x + 40, y - 40, 7, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(x + 30, y - 20, 15, Math.PI, Math.PI * 2);
                    ctx.stroke();
                }
                
                // 文字标识
                ctx.fillStyle = '#fff';
                ctx.font = '16px Arial';
                ctx.fillText('对手', x + 20, y - 60);
            }
            
            // 绘制桌子
            function drawTable() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height - 150;
                
                ctx.save();
                ctx.translate(centerX, centerY);
                
                if (gameState.tableFlipped) {
                    // 掀桌动画
                    gameState.tableAngle += 0.05 * gameState.power;
                    if (gameState.tableAngle > Math.PI / 2) {
                        gameState.tableAngle = Math.PI / 2;
                    }
                    ctx.rotate(-gameState.tableAngle);
                }
                
                // 桌面
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-150, -20, 300, 20);
                
                // 桌腿
                ctx.fillStyle = '#A0522D';
                ctx.fillRect(-120, 0, 20, 100);
                ctx.fillRect(100, 0, 20, 100);
                
                ctx.restore();
            }
            
            // 绘制物品
            function drawItems() {
                gameState.items.forEach(item => {
                    ctx.save();
                    ctx.translate(item.x, item.y);
                    ctx.rotate(item.rotation);
                    
                    if (item.type === 0) {
                        // 酒瓶
                        ctx.fillStyle = '#1a5a1a';
                        ctx.fillRect(-5, -20, 10, 40);
                        ctx.fillStyle = '#c9b458';
                        ctx.fillRect(-5, -25, 10, 5);
                    } else if (item.type === 1) {
                        // 茶杯
                        ctx.fillStyle = '#ffffff';
                        ctx.beginPath();
                        ctx.arc(0, 0, 10, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#1a5a1a';
                        ctx.beginPath();
                        ctx.arc(0, 0, 8, 0, Math.PI * 2);
                        ctx.fill();
                    } else {
                        // 碗
                        ctx.fillStyle = '#ffffff';
                        ctx.beginPath();
                        ctx.arc(0, 0, 12, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    ctx.restore();
                });
            }
            
            // 更新游戏状态
            function update() {
                // 更新蓄力条
                if (gameState.isCharging && !gameState.tableFlipped) {
                    gameState.power += 0.02 * gameState.powerDirection;
                    
                    if (gameState.power >= 1) {
                        gameState.power = 1;
                        gameState.powerDirection = -1;
                    } else if (gameState.power <= 0) {
                        gameState.power = 0;
                        gameState.powerDirection = 1;
                    }
                    
                    powerBar.style.width = (gameState.power * 100) + '%';
                }
                
                // 更新物品位置（如果桌子被掀翻）
                if (gameState.tableFlipped) {
                    gameState.items.forEach(item => {
                        item.x += item.vx;
                        item.y += item.vy;
                        item.vy += 0.5; // 重力
                        item.rotation += item.rotationSpeed;
                        
                        // 边界检查
                        if (item.y > canvas.height - 50) {
                            item.y = canvas.height - 50;
                            item.vy = -item.vy * 0.6; // 弹性碰撞
                        }
                    });
                }
            }
            
            // 游戏主循环
            function gameLoop() {
                if (!gameState.isPlaying) return;
                
                update();
                draw();
                
                requestAnimationFrame(gameLoop);
            }
            
            // 音频加载事件
            let audioLoadCount = 0;
            const totalAudioFiles = 2;
            
            function checkAudioLoaded() {
                audioLoadCount++;
                if (audioLoadCount === totalAudioFiles) {
                    audioLoaded = true;
                    audioStatus.textContent = '音频已加载';
                    audioStatus.style.color = '#00ff00';
                    console.log("所有音频加载完成");
                }
            }
            
            flipSound.addEventListener('canplaythrough', checkAudioLoaded);
            bgMusic.addEventListener('canplaythrough', checkAudioLoaded);
            
            flipSound.addEventListener('error', function() {
                audioStatus.textContent = '掀桌音效加载失败';
                audioStatus.style.color = '#ff0000';
                console.log("掀桌音效加载失败");
            });
            
            bgMusic.addEventListener('error', function() {
                audioStatus.textContent = '背景音乐加载失败';
                audioStatus.style.color = '#ff0000';
                console.log("背景音乐加载失败");
            });
            
            // 事件监听
            canvas.addEventListener('mousedown', function() {
                if (gameState.isPlaying && !gameState.tableFlipped) {
                    gameState.isCharging = true;
                }
            });
            
            canvas.addEventListener('mouseup', function() {
                if (gameState.isCharging) {
                    flipTable();
                }
            });
            
            // 触摸设备支持
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                if (gameState.isPlaying && !gameState.tableFlipped) {
                    gameState.isCharging = true;
                }
            });
            
            canvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                if (gameState.isCharging) {
                    flipTable();
                }
            });
            
            // 按钮事件
            startBtn.addEventListener('click', startGame);
            resetBtn.addEventListener('click', resetGame);
            helpBtn.addEventListener('click', function() {
                showMessage('按住蓄力，绿色区域释放！', '#ff8a00');
            });
            bgMusicBtn.addEventListener('click', toggleBgMusic);
            flipSoundBtn.addEventListener('click', testFlipSound);
            
            // 音量控制
            volumeSlider.addEventListener('input', function() {
                setVolume(this.value);
            });
            
            // 初始设置
            setVolume(50); // 设置初始音量
            
            // 初始绘制
            draw();
            showMessage('点击"开始游戏"按钮开始！', '#ff8a00');
        });
    </script>
</body>
</html>